Функция ПолучитьКурсыВалют() 
	// Пример строки  https://cbrates.rbc.ru/tsv/978/2022/05/08.tsv
	Сервер = "cbrates.rbc.ru";
	Дата = Формат(Объект.Дата,"ДФ = /гггг/ММ/дд") ;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(Валюты.Код, 0) КАК Код,
	|	Валюты.Наименование КАК Наименование,
	|	Валюты.БуквенныйКод КАК БуквенныйКод
	|ИЗ
	|	Справочник.Валюты КАК Валюты
	|ГДЕ
	|	Валюты.Код <> ""643""";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	ДокументУК = Документы.УстановкаКурсаВалют.СоздатьДокумент();
	ДокументУК.Дата = Объект.Дата;
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		Попытка
			HTTP = Новый HTTPСоединение(Сервер);
		Исключение
			Сообщить("Не удалось подключиться");
			Возврат Ложь;
		КонецПопытки;
		
		//На определенную дату  и коду, кроме рубля
		
		Адрес = "tsv/" + ВыборкаДетальныеЗаписи.Код + Дата + ".tsv";
		
		
		HTTPЗапрос = Новый HTTPЗапрос(Адрес); 
		
		Попытка
			HTTPОтвет = HTTP.Получить(HTTPЗапрос);	
		Исключение
			Сообщить("Нет ответа от требуемого сервера");
			Возврат Ложь;
		КонецПопытки;
			
		Текст = HTTPОтвет.ПолучитьТелоКакСтроку("windows-1251");
					
		Для ИндексСтроки = 1 По СтрЧислоСтрок(Текст) Цикл
			
			СтрокаКурса = СтрПолучитьСтроку(Текст, ИндексСтроки);
			//Распарсить строку с курсом по символу табуляции
			МногострочнаяСтрока = СтрЗаменить(СтрокаКурса, "	", Символы.ПС);
			КратностьКурса = СтрПолучитьСтроку(МногострочнаяСтрока, 1);
			Курс = СтрПолучитьСтроку(МногострочнаяСтрока, 2);
			
			НоваяСтрока = ДокументУК.Курсы.Добавить();
			НоваяСтрока.Код = ВыборкаДетальныеЗаписи.Код; 
			НоваяСтрока.Валюта = Справочники.Валюты.НайтиПоНаименованию(ВыборкаДетальныеЗаписи.Наименование,0);
			НоваяСтрока.Курс = Курс;
			НоваяСтрока.Кратность = КратностьКурса;
			НоваяСтрока.БуквенныйКод = Справочники.Валюты.НайтиПоНаименованию(ВыборкаДетальныеЗаписи.БуквенныйКод,0);
					
		КонецЦикла;	
	КонецЦикла;
	
	ДокументУК.Записать(РежимЗаписиДокумента.Запись);
	Сообщить("Документ: " + ДокументУК + " создан");
КонецФункции

&НаКлиенте
Процедура Загрузить(Команда)
	ПолучитьКурсыВалют();
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Объект.Дата = ТекущаяДата();
КонецПроцедуры
